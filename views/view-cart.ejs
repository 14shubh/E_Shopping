<!DOCTYPE html>
<html lang="en">
<head>
  <title><%=title%></title>
  <%-include('partial/bootstrap.ejs')%>
  <link rel="stylesheet" href="css/style.css"/>
   <style>
     .card{
       width: 300px;
       min-height: 300px;
     }
     .card-img-top{
       width: 100%;
       height: 200px;
     }
   </style>
</head>
<body>
<script>
    function getCartItem(){
      $.ajax({
          url: '/cart/cart-item',
          success: function(result){
            for(index=0; index< result.length; index++)
              result[index].quantity = 1;

            localStorage.setItem("item-list",JSON.stringify(result));
          }
      });
    }
    getCartItem();
</script>    
<%- include('partial/navigation_bar.ejs')%>
<div class="container mt-4">
    <div class="row">
      <div class="col-12">
        <table class="table mt-5">
          <tr>
            <th>Image</th>
            <th>Product-Info</th>
            <th>Price</th>
            <th>Qty</th>
            <th>Total</th>
            <th>Remove</th>
          </tr>
          <tbody>
            
            <%for(index=0; index < cartItemList.length; index++){%>
                <tr>
                    <td><img width="100px" height="100px" src="/products_images/<%=cartItemList[index].product_Image1%>"/></td>
                    <td>
                        <b>Name :</b> <%=cartItemList[index].product_Name%>
                        <br><b>Desc :</b> <%=cartItemList[index].description%>
                        <br><b>In stock :</b> <%=cartItemList[index].quantity%>
                    </td>
                    <td><%=cartItemList[index].price%></td>
                    <td>
                        <input onchange="updateQty(this.value,'<%=cartItemList[index].price%>','<%=index%>')" style="width:60px;" type="number" min="1" max="<%=cartItemList[index].quantity%>"/>
                    </td>
                    <td><span id="total<%=index%>"></span></td>
                    <td>
                        <button class="btn btn-danger">Remove</button>
                    </td>
                </tr> 
                <%}%> 
              
           </tbody>
         </table>
         <div class="row justify-content-center p-5">
             <button data-toggle="modal" data-target="#myModal" class="btn btn-primary">Order Placed</button>
         </div>
        </div>
    </div>
</div>

<div class="modal" id="myModal">
    <div class="modal-dialog">
      <div class="modal-content">
  
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Address Information</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
  
        <!-- Modal body -->
        <div class="modal-body">
          
          <div class="form-group">
              <label>Address</label>
              <textarea id="address" class="form-control"></textarea>
          </div>
          <div class="form-group">
              <label>Contact Number</label>
              <input type="text" id="contact" class="form-control"/>
          </div>
        </div>
  
        <!-- Modal footer -->
        <div class="modal-footer">
          <button onclick="placeOrder()" type="button" class="btn btn-success">Done</button>
        </div>
  
      </div>
    </div>
  </div>

<script>
    function placeOrder(){
       var address = document.getElementById("address").value;
       var contact = document.getElementById("contact").value; 
       var itemList =  localStorage.getItem("item-list");
       $.ajax({
           url: "/order/place-order/"+itemList+"/"+address+"/"+contact,
           success : function(result){
               alert("Order Placed......");
           }
       });
    }
    function updateQty(qty,price,index){
      var spanObj = document.getElementById("total"+index);
      var total = (qty*1) * (price*1);
      spanObj.innerHTML = ""+total;
      itemList = localStorage.getItem("item-list");
      itemList = JSON.parse(itemList);
      itemList[index].quantity = qty*1;
      localStorage.setItem("item-list",JSON.stringify(itemList));
    }
</script>
</body>
</html>
